<!DOCTYPE html>
<html lang="zh-HK">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>å¤§åŸ”ç«ç½ - ç‰©è³‡è³‡è¨Šæ•´åˆå¹³å°</title>

  <script src="https://cdn.tailwindcss.com"></script>
  <link
    href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Noto+Sans+TC:wght@300;400;500;700&display=swap"
    rel="stylesheet">

  <script>
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: { sans: ['Inter', 'Noto Sans TC', 'sans-serif'] },
          colors: {
            brand: { 50: '#fff1f2', 100: '#ffe4e6', 500: '#f43f5e', 600: '#e11d48', 900: '#881337' }
          }
        },
      },
    }
  </script>

  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <script type="importmap">
    {
      "imports": {
        "react": "https://esm.sh/react@18.2.0",
        "react-dom/client": "https://esm.sh/react-dom@18.2.0/client",
        "lucide-react": "https://esm.sh/lucide-react@0.263.1",
        "html2canvas": "https://esm.sh/html2canvas@1.4.1"
      }
    }
    </script>

  <style>
    body {
      background-color: #f8fafc;
    }
  </style>
</head>

<body class="bg-slate-50 text-slate-900 antialiased">

  <div id="root"></div>

  <script type="text/babel" data-type="module">
    import React, { useState, useEffect } from 'react';
    import { createRoot } from 'react-dom/client';
    import { Flame, Info, Menu, X, BarChart3, ExternalLink } from 'lucide-react';

    // ==========================================
    // ğŸš¨ ä¸´æ—¶æ›¿èº«åŒºåŸŸ (Mock Components)
    // å› ä¸ºä½ æ²¡ç»™æˆ‘ components æ–‡ä»¶å¤¹é‡Œçš„ä»£ç ï¼Œ
    // æˆ‘å…ˆé€ è¿™äº›ç®€å•çš„å£³å­ï¼Œé˜²æ­¢ç™½å±æŠ¥é”™ã€‚
    // ==========================================

    const SmartInput = ({ onEntriesParsed }) => (
      <div className="bg-white p-4 rounded-xl shadow-sm border border-slate-200">
        <h3 className="font-bold text-slate-700">æ™ºèƒ½è¼¸å…¥ (SmartInput)</h3>
        <p className="text-sm text-slate-500 mb-2">æ­¤å¤„åŸæœ¬æ˜¯ AI åˆ†ææ¡†ï¼Œç”±äºç¼ºå°‘ä»£ç æš‚æ—¶æ— æ³•ä½¿ç”¨ã€‚</p>
        <button onClick={() => alert('è¯·ä¸Šä¼  SmartInput.tsx ä»£ç ä»¥æ¿€æ´»æ­¤åŠŸèƒ½')} className="bg-blue-600 text-white px-4 py-2 rounded">æ¨¡æ‹Ÿæ·»åŠ </button>
      </div>
    );

    const StatsCards = ({ stats }) => (
      <div className="grid grid-cols-2 md:grid-cols-4 gap-4 mb-8">
        <div className="bg-white p-4 rounded-xl shadow-sm border-l-4 border-red-500">éœ€æ±‚: {stats.totalNeeds}</div>
        <div className="bg-white p-4 rounded-xl shadow-sm border-l-4 border-green-500">æä¾›: {stats.totalOffers}</div>
        <div className="bg-white p-4 rounded-xl shadow-sm border-l-4 border-blue-500">å·²å®Œæˆ: {stats.completed}</div>
        <div className="bg-white p-4 rounded-xl shadow-sm border-l-4 border-orange-500">ç·Šæ€¥: {stats.highUrgency}</div>
      </div>
    );

    const ReliefTable = ({ entries }) => (
      <div className="bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden">
        <div className="p-4 border-b bg-slate-50 font-bold">ç‰©è³‡åˆ—è¡¨ (ReliefTable)</div>
        <div className="p-4">
          {entries.map(e => (
            <div key={e.id} className="p-2 border-b flex justify-between">
              <span>{e.type === 'NEED' ? 'ğŸ”´ éœ€æ±‚' : 'ğŸŸ¢ æä¾›'}: {e.item} ({e.quantity})</span>
              <span className="text-slate-500">{e.location}</span>
            </div>
          ))}
        </div>
      </div>
    );

    const LocationStatusBoard = ({ locations }) => (
      <div className="mb-8 grid gap-4 grid-cols-1 md:grid-cols-2 lg:grid-cols-3">
        {locations.slice(0, 3).map(loc => (
          <div key={loc.id} className="bg-white p-4 rounded-xl border border-slate-200">
            <div className="font-bold">{loc.location_name}</div>
            <div className="text-sm text-slate-500">{loc.current_status}</div>
          </div>
        ))}
        <div className="col-span-full text-center text-slate-400 text-sm">...æ›´å¤šåœ°é» (ç”±æ–¼ç¼ºå°‘çµ„ä»¶ä»£ç¢¼ï¼Œåƒ…é¡¯ç¤ºéƒ¨åˆ†)</div>
      </div>
    );

    // å…¶ä»–ç®€å•çš„å ä½ç¬¦
    const SuppliesSummary = ({ isOpen, onClose }) => isOpen ? <div className="fixed inset-0 bg-black/50 z-50 flex items-center justify-center"><div className="bg-white p-8 rounded">çµ±è¨ˆæ‘˜è¦ (ç¼ºä»£ç¢¼)<button onClick={onClose} className="ml-4 bg-gray-200 px-2">é—œé–‰</button></div></div> : null;
    const SFExpressNotice = () => <div className="bg-slate-800 text-white p-4 rounded-xl">é †è±é€šå‘Š (ç¼ºä»£ç¢¼)</div>;
    const EmotionalSupportCard = () => <div className="bg-pink-50 text-pink-800 p-4 rounded-xl">æƒ…ç·’æ”¯æ´ (ç¼ºä»£ç¢¼)</div>;


    // ==========================================
    // ğŸ’¾ åŸå§‹æ•°æ® (ä»ä½ çš„ä»£ç é‡Œæ¬è¿‡æ¥çš„)
    // ==========================================

    const MOCK_INITIAL_DATA = [
      {
        id: '1', type: 'NEED', category: 'é£Ÿå“', item: 'ä¾¿ç•¶/ç†±é£Ÿ', quantity: '50 ä»½',
        location: 'å¤§åŸ”é«”è‚²é¤¨é¿é›£ä¸­å¿ƒ', contactInfo: 'é™³ç¤¾å·¥ 9123 4567',
        urgency: 'HIGH', status: 'PENDING', timestamp: Date.now() - 1000 * 60 * 30,
        originalMessage: 'æ€¥ï¼é¿é›£ä¸­å¿ƒç¼º50å€‹ä¾¿ç•¶ï¼Œè€äººå¤šï¼Œéœ€è¦ç†±é£Ÿã€‚', notes: 'éœ€åŒ…å« 10 ä»½ç´ é£Ÿ',
      },
      {
        id: '2', type: 'OFFER', category: 'äº¤é€š', item: '7äººè»Šç¾©è¼‰', quantity: '2 éƒ¨è»Š',
        location: 'å¤§åŸ”å¢Ÿç«™ A å‡ºå£', contactInfo: 'Gary 6666 7777',
        urgency: 'MEDIUM', status: 'PENDING', timestamp: Date.now() - 1000 * 60 * 60,
        originalMessage: 'æˆ‘å¯ä»¥å‡ºå…©éƒ¨è»Šå¹«æ‰‹é‹ç‰©è³‡ï¼Œä¿‚ç«è»Šç«™ç­‰ã€‚', notes: 'æ™šä¸Š 8 é»å¾Œå¯å‡ºè»Š',
      }
    ];

    const STATIC_LOCATION_DATA = [
      { "id": "loc-1", "location_name": "å¤§åŸ”ç¤¾å€æœƒå ‚", "contacts": [{ "name": "Chester", "phone": "91786880" }], "current_status": "æš«ç„¡ç‰¹åˆ¥è¨»æ˜", "needs_support": null },
      { "id": "loc-2", "location_name": "æ–‡å¨›ä¸­å¿ƒ", "contacts": [{ "name": "Carman", "phone": "54463262" }], "current_status": "ç›®å‰æœ‰å¤§é‡äººæ‰‹åŠç‰©è³‡", "needs_support": false }
    ];

    // ==========================================
    // ğŸš€ ä¸»ç¨‹åº App (ä½ çš„æ ¸å¿ƒä»£ç )
    // ==========================================

    function App() {
      const [entries, setEntries] = useState(() => {
        const saved = localStorage.getItem('relief_entries');
        return saved ? JSON.parse(saved) : MOCK_INITIAL_DATA;
      });

      const [locations, setLocations] = useState(() => {
        const saved = localStorage.getItem('relief_locations');
        if (saved) return JSON.parse(saved);
        return STATIC_LOCATION_DATA;
      });

      const [mobileMenuOpen, setMobileMenuOpen] = useState(false);
      const [isSummaryOpen, setIsSummaryOpen] = useState(false);

      useEffect(() => { localStorage.setItem('relief_entries', JSON.stringify(entries)); }, [entries]);
      useEffect(() => { localStorage.setItem('relief_locations', JSON.stringify(locations)); }, [locations]);

      const stats = {
        totalNeeds: entries.filter(e => e.type === 'NEED' && e.status !== 'COMPLETED').length,
        totalOffers: entries.filter(e => e.type === 'OFFER' && e.status !== 'COMPLETED').length,
        completed: entries.filter(e => e.status === 'COMPLETED').length,
        highUrgency: entries.filter(e => e.urgency === 'HIGH' && e.status !== 'COMPLETED').length,
      };

      const handleNewEntries = (newEntries) => setEntries(prev => [...newEntries, ...prev]);
      const handleUpdateStatus = (id, newStatus) => setEntries(prev => prev.map(e => e.id === id ? { ...e, status: newStatus } : e));
      const handleDelete = (id) => setEntries(prev => prev.filter(e => e.id !== id));
      const handleEditEntry = (id, updatedEntry) => setEntries(prev => prev.map(e => e.id === id ? { ...e, ...updatedEntry, timestamp: Date.now() } : e));

      const handleManualAdd = () => {
        const id = `manual-${Date.now()}`;
        const newEntry = {
          id, type: 'NEED', category: 'æœªåˆ†é¡', item: 'æ–°å¢ç‰©å“', quantity: '1',
          location: 'å¾…å®š', contactInfo: 'ç„¡', urgency: 'MEDIUM', status: 'PENDING',
          timestamp: Date.now(), originalMessage: 'æ‰‹å‹•æ–°å¢é …ç›®', notes: '',
        };
        setEntries(prev => [newEntry, ...prev]);
        return newEntry;
      };

      const handleUpdateLocation = (id, updatedData) => setLocations(prev => prev.map(loc => loc.id === id ? { ...loc, ...updatedData } : loc));
      const handleAddLocation = () => {
        const id = `loc-${Date.now()}`;
        const newLocation = { id, location_name: "æ–°æ•‘æ´ç«™é»", contacts: [], current_status: "è«‹æ›´æ–°...", needs_support: null };
        setLocations(prev => [newLocation, ...prev]);
      };
      const handleDeleteLocation = (id) => setLocations(prev => prev.filter(loc => loc.id !== id));

      return (
        <div className="min-h-screen flex flex-col font-sans">
          <SuppliesSummary
            entries={entries} isOpen={isSummaryOpen} onClose={() => setIsSummaryOpen(false)}
            onEdit={handleEditEntry} onDelete={handleDelete}
          />

          {/* Navbar */}
          <header className="bg-slate-900 text-white shadow-lg sticky top-0 z-50">
            <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
              <div className="flex justify-between h-16 items-center">
                <div className="flex items-center gap-2">
                  <div className="bg-red-600 p-1.5 rounded-lg shadow-red-900/50 shadow-inner">
                    <Flame className="w-5 h-5 text-white" />
                  </div>
                  <div>
                    <h1 className="text-lg font-bold leading-tight tracking-tight">å¤§åŸ”ç«ç½æ”¯æ´å”èª¿</h1>
                    <p className="text-[10px] text-slate-400 font-medium tracking-wide">RELIEF COORDINATOR</p>
                  </div>
                </div>

                <div className="hidden md:flex items-center gap-6 text-sm font-medium text-slate-300">
                  <span className="flex items-center gap-2 px-3 py-1 rounded-full bg-slate-800 border border-slate-700/50">
                    <div className="w-2 h-2 rounded-full bg-emerald-500 animate-pulse"></div>
                    ç³»çµ±å³æ™‚é‹ä½œä¸­
                  </span>
                  <button onClick={() => setIsSummaryOpen(true)} className="flex items-center gap-2 text-white hover:text-brand-100 bg-white/10 hover:bg-white/20 px-3 py-1.5 rounded-lg transition-all">
                    <BarChart3 className="w-4 h-4" /> ç‰©è³‡çµ±è¨ˆç¸½è¦½
                  </button>
                </div>
                <button className="md:hidden p-2 text-slate-300 hover:text-white" onClick={() => setMobileMenuOpen(!mobileMenuOpen)}>
                  {mobileMenuOpen ? <X /> : <Menu />}
                </button>
              </div>
            </div>
          </header>

          <main className="flex-grow bg-slate-50">
            <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
              <div className="mb-8 flex flex-col md:flex-row md:items-center justify-between gap-4">
                <div>
                  <h2 className="text-2xl font-bold text-slate-900">å³æ™‚ç‰©è³‡èª¿é…ä¸­å¿ƒ</h2>
                  <p className="text-slate-500 mt-1">æ•´åˆ WhatsApp/WeChat è¨Šæ¯ï¼Œè‡ªå‹•æå–åœ°é»èˆ‡éœ€æ±‚ã€‚</p>
                </div>
              </div>

              {/* æ›¿æ¢æˆäº†æˆ‘çš„ä¸´æ—¶ç»„ä»¶ */}
              <StatsCards stats={stats} />
              <LocationStatusBoard locations={locations} />

              <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8">
                <div className="space-y-6">
                  {/* æ›¿æ¢æˆäº†æˆ‘çš„ä¸´æ—¶ç»„ä»¶ */}
                  <SmartInput onEntriesParsed={handleNewEntries} />
                  <div className="bg-blue-50 border border-blue-100 rounded-xl p-4">
                    <div className="flex gap-3">
                      <Info className="w-5 h-5 text-blue-600 shrink-0 mt-0.5" />
                      <div>
                        <h4 className="font-bold text-blue-900 text-sm">å¦‚ä½•ä½¿ç”¨ï¼Ÿ</h4>
                        <p className="text-xs text-blue-800/80 mt-1 leading-relaxed">
                          (åŠŸèƒ½é–‹ç™¼ä¸­ï¼Œè«‹ç­‰å¾…ä¸Šå‚³å®Œæ•´çµ„ä»¶)
                        </p>
                      </div>
                    </div>
                  </div>
                </div>
                <div><SFExpressNotice /></div>
                <div><EmotionalSupportCard /></div>
              </div>

              <div className="w-full">
                {/* æ›¿æ¢æˆäº†æˆ‘çš„ä¸´æ—¶ç»„ä»¶ */}
                <ReliefTable entries={entries} />
              </div>
            </div>
          </main>

          <footer className="bg-white border-t border-slate-200 py-8">
            <div className="max-w-7xl mx-auto px-4 text-center">
              <p className="text-slate-400 text-sm mb-2">æ­¤å¹³å°ç‚ºç·Šæ€¥å³æ™‚é–‹ç™¼ã€‚</p>
            </div>
          </footer>
        </div>
      );
    }

    const root = createRoot(document.getElementById('root'));
    root.render(<App />); 
  </script>
</body>

</html>